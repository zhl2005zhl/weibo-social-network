# 微博系统技术解决方案设计

## 1. 数据库设计

### 1.1 ER图设计
- **实体**：用户(User)、动态(Post)、评论(Comment)、点赞(Like)、转发(Repost)、关注(Follow)、通知(Notification)、文件(File)
- **关系**：
  - 用户与动态：一对多
  - 用户与评论：一对多
  - 用户与点赞：一对多
  - 用户与转发：一对多
  - 用户与关注：多对多
  - 用户与粉丝：多对多
  - 动态与评论：一对多
  - 动态与点赞：一对多
  - 动态与转发：一对多
  - 动态与文件：一对多
  - 用户与通知：一对多

### 1.2 数据表结构设计
```sql
-- 用户表
CREATE TABLE `user` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL UNIQUE COMMENT '用户名',
  `password` varchar(255) NOT NULL COMMENT '密码（加密存储）',
  `email` varchar(100) NOT NULL UNIQUE COMMENT '邮箱',
  `phone` varchar(20) UNIQUE COMMENT '手机号',
  `nickname` varchar(50) NOT NULL COMMENT '昵称',
  `avatar_id` bigint COMMENT '头像文件ID',
  `bio` varchar(200) COMMENT '个人简介',
  `location` varchar(100) COMMENT '所在地',
  `website` varchar(200) COMMENT '个人网站',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态：1-正常，0-禁用',
  PRIMARY KEY (`id`),
  INDEX `idx_username` (`username`),
  INDEX `idx_email` (`email`),
  INDEX `idx_phone` (`phone`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';

-- 文件表
CREATE TABLE `file` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `filename` varchar(255) NOT NULL COMMENT '文件名',
  `original_filename` varchar(255) NOT NULL COMMENT '原始文件名',
  `content_type` varchar(100) NOT NULL COMMENT '文件类型',
  `size` bigint NOT NULL COMMENT '文件大小',
  `path` varchar(255) NOT NULL COMMENT '文件存储路径',
  `url` varchar(500) NOT NULL COMMENT '访问URL',
  `uploader_id` bigint NOT NULL COMMENT '上传者ID',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  INDEX `idx_uploader_id` (`uploader_id`),
  FOREIGN KEY (`uploader_id`) REFERENCES `user` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文件表';

-- 动态表
CREATE TABLE `post` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `content` text NOT NULL COMMENT '动态内容',
  `author_id` bigint NOT NULL COMMENT '作者ID',
  `parent_id` bigint COMMENT '转发的原动态ID',
  `likes_count` int NOT NULL DEFAULT 0 COMMENT '点赞数',
  `comments_count` int NOT NULL DEFAULT 0 COMMENT '评论数',
  `reposts_count` int NOT NULL DEFAULT 0 COMMENT '转发数',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  INDEX `idx_author_id` (`author_id`),
  INDEX `idx_parent_id` (`parent_id`),
  INDEX `idx_created_at` (`created_at`),
  FOREIGN KEY (`author_id`) REFERENCES `user` (`id`) ON DELETE CASCADE,
  FOREIGN KEY (`parent_id`) REFERENCES `post` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动态表';

-- 动态文件关联表
CREATE TABLE `post_file` (
  `post_id` bigint NOT NULL COMMENT '动态ID',
  `file_id` bigint NOT NULL COMMENT '文件ID',
  PRIMARY KEY (`post_id`, `file_id`),
  FOREIGN KEY (`post_id`) REFERENCES `post` (`id`) ON DELETE CASCADE,
  FOREIGN KEY (`file_id`) REFERENCES `file` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动态文件关联表';

-- 评论表
CREATE TABLE `comment` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `content` text NOT NULL COMMENT '评论内容',
  `author_id` bigint NOT NULL COMMENT '评论者ID',
  `post_id` bigint NOT NULL COMMENT '动态ID',
  `parent_id` bigint COMMENT '父评论ID',
  `likes_count` int NOT NULL DEFAULT 0 COMMENT '点赞数',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  INDEX `idx_author_id` (`author_id`),
  INDEX `idx_post_id` (`post_id`),
  INDEX `idx_parent_id` (`parent_id`),
  FOREIGN KEY (`author_id`) REFERENCES `user` (`id`) ON DELETE CASCADE,
  FOREIGN KEY (`post_id`) REFERENCES `post` (`id`) ON DELETE CASCADE,
  FOREIGN KEY (`parent_id`) REFERENCES `comment` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论表';

-- 点赞表
CREATE TABLE `like` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `user_id` bigint NOT NULL COMMENT '点赞者ID',
  `target_type` tinyint NOT NULL COMMENT '点赞目标类型：1-动态，2-评论',
  `target_id` bigint NOT NULL COMMENT '点赞目标ID',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_target` (`user_id`, `target_type`, `target_id`),
  INDEX `idx_target` (`target_type`, `target_id`),
  FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='点赞表';

-- 关注表
CREATE TABLE `follow` (
  `follower_id` bigint NOT NULL COMMENT '关注者ID',
  `following_id` bigint NOT NULL COMMENT '被关注者ID',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '关注时间',
  PRIMARY KEY (`follower_id`, `following_id`),
  INDEX `idx_following` (`following_id`),
  FOREIGN KEY (`follower_id`) REFERENCES `user` (`id`) ON DELETE CASCADE,
  FOREIGN KEY (`following_id`) REFERENCES `user` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='关注表';

-- 通知表
CREATE TABLE `notification` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `user_id` bigint NOT NULL COMMENT '接收通知用户ID',
  `sender_id` bigint NOT NULL COMMENT '发送者ID',
  `type` tinyint NOT NULL COMMENT '通知类型：1-点赞，2-评论，3-转发，4-关注',
  `content` text NOT NULL COMMENT '通知内容',
  `target_id` bigint NOT NULL COMMENT '关联目标ID',
  `is_read` tinyint NOT NULL DEFAULT 0 COMMENT '是否已读：0-未读，1-已读',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_is_read` (`is_read`),
  FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE CASCADE,
  FOREIGN KEY (`sender_id`) REFERENCES `user` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='通知表';
```

### 1.3 数据库选型理由及性能优化策略
- **选型理由**：MySQL 是成熟的关系型数据库，支持事务，适合存储结构化数据，社区活跃，文档丰富
- **性能优化策略**：
  - 合理设计索引，加速查询
  - 对大字段使用适当的数据类型
  - 使用读写分离架构，提高并发处理能力
  - 对热点数据进行缓存
  - 定期优化表结构和索引

## 2. 后端实现方案

### 2.1 项目结构设计
```
weibo-backend/
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/weibo/
│   │   │       ├── WeiboApplication.java          # 应用入口
│   │   │       ├── config/                        # 配置类
│   │   │       │   ├── SecurityConfig.java       # 安全配置
│   │   │       │   ├── SwaggerConfig.java        # Swagger配置
│   │   │       │   └── WebConfig.java            # Web配置
│   │   │       ├── controller/                   # 控制器层
│   │   │       │   ├── v1/                       # API版本1
│   │   │       │   │   ├── AuthController.java   # 认证相关接口
│   │   │       │   │   ├── UserController.java   # 用户相关接口
│   │   │       │   │   ├── PostController.java   # 动态相关接口
│   │   │       │   │   ├── CommentController.java # 评论相关接口
│   │   │       │   │   ├── LikeController.java   # 点赞相关接口
│   │   │       │   │   ├── FollowController.java # 关注相关接口
│   │   │       │   │   └── NotificationController.java # 通知相关接口
│   │   │       │   └── FileController.java       # 文件上传下载接口
│   │   │       ├── service/                      # 服务层
│   │   │       │   ├── AuthService.java          # 认证服务
│   │   │       │   ├── UserService.java          # 用户服务
│   │   │       │   ├── PostService.java          # 动态服务
│   │   │       │   ├── CommentService.java       # 评论服务
│   │   │       │   ├── LikeService.java          # 点赞服务
│   │   │       │   ├── FollowService.java        # 关注服务
│   │   │       │   ├── NotificationService.java  # 通知服务
│   │   │       │   └── FileService.java          # 文件服务
│   │   │       ├── repository/                   # 数据访问层
│   │   │       │   ├── UserRepository.java       # 用户DAO
│   │   │       │   ├── PostRepository.java       # 动态DAO
│   │   │       │   ├── CommentRepository.java    # 评论DAO
│   │   │       │   ├── LikeRepository.java       # 点赞DAO
│   │   │       │   ├── FollowRepository.java     # 关注DAO
│   │   │       │   ├── NotificationRepository.java # 通知DAO
│   │   │       │   └── FileRepository.java       # 文件DAO
│   │   │       ├── entity/                       # 实体类
│   │   │       │   ├── User.java                 # 用户实体
│   │   │       │   ├── Post.java                 # 动态实体
│   │   │       │   ├── Comment.java              # 评论实体
│   │   │       │   ├── Like.java                 # 点赞实体
│   │   │       │   ├── Follow.java               # 关注实体
│   │   │       │   ├── Notification.java         # 通知实体
│   │   │       │   └── File.java                 # 文件实体
│   │   │       ├── dto/                          # 数据传输对象
│   │   │       │   ├── LoginDTO.java             # 登录请求DTO
│   │   │       │   ├── RegisterDTO.java          # 注册请求DTO
│   │   │       │   ├── PostDTO.java              # 动态DTO
│   │   │       │   ├── CommentDTO.java           # 评论DTO
│   │   │       │   └── NotificationDTO.java      # 通知DTO
│   │   │       ├── vo/                           # 视图对象
│   │   │       │   ├── UserVO.java               # 用户VO
│   │   │       │   ├── PostVO.java               # 动态VO
│   │   │       │   ├── CommentVO.java            # 评论VO
│   │   │       │   └── NotificationVO.java       # 通知VO
│   │   │       ├── enums/                        # 枚举类
│   │   │       │   ├── LikeType.java             # 点赞类型枚举
│   │   │       │   ├── NotificationType.java     # 通知类型枚举
│   │   │       │   └── UserStatus.java           # 用户状态枚举
│   │   │       ├── exception/                    # 异常处理
│   │   │       │   ├── GlobalExceptionHandler.java # 全局异常处理器
│   │   │       │   └── BusinessException.java    # 业务异常类
│   │   │       └── util/                         # 工具类
│   │   │           ├── JwtUtil.java              # JWT工具类
│   │   │           ├── SecurityUtil.java         # 安全工具类
│   │   │           └── FileUtil.java             # 文件处理工具类
│   │   └── resources/
│   │       ├── application.yml                   # 应用配置
│   │       ├── application-dev.yml               # 开发环境配置
│   │       ├── application-prod.yml              # 生产环境配置
│   │       └── static/                           # 静态资源
│   └── test/                                     # 测试代码
├── Dockerfile                                    # Docker配置
├── docker-compose.yml                            # Docker Compose配置
├── pom.xml                                       # Maven依赖
└── README.md                                     # 项目说明
```

### 2.2 核心业务流程设计

#### 2.2.1 用户认证流程
1. 用户发送登录请求，携带用户名和密码
2. 后端验证用户名和密码
3. 验证通过，生成JWT Token返回给前端
4. 前端存储Token，后续请求携带Token
5. 后端通过JWT过滤器验证Token合法性

#### 2.2.2 动态发布流程
1. 用户发送动态发布请求，携带文字内容和图片文件
2. 后端验证用户身份
3. 上传图片文件到服务器或云存储
4. 创建动态记录，关联用户和文件
5. 返回创建结果

#### 2.2.3 点赞流程
1. 用户发送点赞请求，携带目标类型和ID
2. 后端验证用户身份
3. 检查是否已点赞
4. 未点赞则创建点赞记录，更新目标点赞数
5. 发送点赞通知给目标作者
6. 返回点赞结果

### 2.3 安全认证实现
- 使用Spring Security + JWT实现认证授权
- 密码加密存储（BCrypt）
- 实现JWT过滤器验证Token
- 配置CORS，允许跨域请求
- 实现XSS过滤和SQL注入防护

### 2.4 异常处理机制
- 自定义业务异常类
- 实现全局异常处理器
- 统一返回格式：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {}
  }
  ```

### 2.5 缓存策略
- 使用Redis缓存热点数据
  - 用户信息缓存
  - 热门动态缓存
  - 关注关系缓存
  - 点赞状态缓存
- 实现缓存失效机制

## 3. 前端实现方案

### 3.1 项目结构设计
```
weibo-frontend/
├── src/
│   ├── assets/                  # 静态资源
│   ├── components/              # 公共组件
│   │   ├── Header.vue           # 顶部导航
│   │   ├── Footer.vue           # 底部信息
│   │   ├── PostCard.vue         # 动态卡片
│   │   ├── CommentList.vue      # 评论列表
│   │   └── Avatar.vue           # 头像组件
│   ├── views/                   # 页面组件
│   │   ├── Home.vue             # 首页
│   │   ├── Login.vue            # 登录页
│   │   ├── Register.vue         # 注册页
│   │   ├── UserProfile.vue      # 用户资料页
│   │   ├── PostDetail.vue       # 动态详情页
│   │   ├── Notification.vue     # 通知页
│   │   └── Settings.vue         # 设置页
│   ├── router/                  # 路由配置
│   │   └── index.ts             # 路由定义
│   ├── stores/                  # 状态管理
│   │   ├── user.ts              # 用户状态
│   │   ├── post.ts              # 动态状态
│   │   ├── comment.ts           # 评论状态
│   │   ├── like.ts              # 点赞状态
│   │   ├── follow.ts            # 关注状态
│   │   └── notification.ts      # 通知状态
│   ├── services/                # API服务
│   │   ├── api.ts               # Axios配置
│   │   ├── auth.ts              # 认证API
│   │   ├── user.ts              # 用户API
│   │   ├── post.ts              # 动态API
│   │   ├── comment.ts           # 评论API
│   │   ├── like.ts              # 点赞API
│   │   ├── follow.ts            # 关注API
│   │   └── notification.ts      # 通知API
│   ├── utils/                   # 工具函数
│   │   ├── jwt.ts               # JWT工具
│   │   └── validation.ts        # 表单验证
│   ├── types/                   # TypeScript类型定义
│   │   ├── user.ts              # 用户类型
│   │   ├── post.ts              # 动态类型
│   │   ├── comment.ts           # 评论类型
│   │   └── notification.ts      # 通知类型
│   ├── App.vue                  # 根组件
│   └── main.ts                  # 入口文件
├── public/                      # 公共资源
├── Dockerfile                   # Docker配置
├── docker-compose.yml           # Docker Compose配置
├── vite.config.ts               # Vite配置
├── tsconfig.json                # TypeScript配置
├── package.json                 # 项目依赖
└── README.md                    # 项目说明
```

### 3.2 状态管理设计
- 使用Pinia进行状态管理
- 按功能模块划分store：
  - user：用户信息、登录状态
  - post：动态列表、动态详情
  - comment：评论列表
  - like：点赞状态
  - follow：关注状态
  - notification：通知列表

### 3.3 路由设计
```typescript
const routes = [
  {
    path: '/',
    name: 'Home',
    component: () => import('../views/Home.vue'),
    meta: { requiresAuth: true }
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('../views/Login.vue'),
    meta: { requiresAuth: false }
  },
  {
    path: '/register',
    name: 'Register',
    component: () => import('../views/Register.vue'),
    meta: { requiresAuth: false }
  },
  {
    path: '/user/:id',
    name: 'UserProfile',
    component: () => import('../views/UserProfile.vue'),
    meta: { requiresAuth: true }
  },
  {
    path: '/post/:id',
    name: 'PostDetail',
    component: () => import('../views/PostDetail.vue'),
    meta: { requiresAuth: true }
  },
  {
    path: '/notification',
    name: 'Notification',
    component: () => import('../views/Notification.vue'),
    meta: { requiresAuth: true }
  },
  {
    path: '/settings',
    name: 'Settings',
    component: () => import('../views/Settings.vue'),
    meta: { requiresAuth: true }
  }
]
```

### 3.4 响应式布局实现
- 使用Element Plus的响应式设计
- 针对不同屏幕尺寸优化布局
- 移动端使用弹性布局，桌面端使用网格布局

### 3.5 核心页面设计

#### 3.5.1 首页设计
- 顶部导航栏：Logo、搜索框、发布按钮、通知图标、用户头像
- 左侧边栏：关注动态、热门动态、话题分类
- 中间内容区：动态列表、动态发布框
- 右侧边栏：推荐关注、热门话题

#### 3.5.2 动态卡片设计
- 用户头像、昵称、发布时间
- 动态内容（文字+图片）
- 点赞、评论、转发按钮
- 评论列表折叠/展开

## 4. 前后端联调指南

### 4.1 开发环境配置
- 后端：JDK 17+、Maven 3.6+、MySQL 8.0+、Redis 6.0+
- 前端：Node.js 16+、npm 8+

### 4.2 接口联调流程
1. 后端启动服务，端口8080
2. 前端配置API baseURL为http://localhost:8080
3. 使用Swagger UI（http://localhost:8080/swagger-ui.html）查看接口文档
4. 前端调用接口进行功能测试
5. 使用Postman进行接口测试

### 4.3 常见问题解决方案
- 跨域问题：后端配置CORS允许前端域名访问
- Token过期：前端检测Token过期，跳转到登录页
- 文件上传失败：检查文件大小限制、格式限制
- 数据库连接失败：检查数据库配置、网络连接

## 5. 系统架构与扩展性设计

### 5.1 整体架构图
```
┌─────────────────────────────────────────────────────────────────┐
│                        客户端层                                  │
├─────────────────────────────────────────────────────────────────┤
│  Web浏览器  │  移动应用  │  第三方应用                           │
├─────────────────────────────────────────────────────────────────┤
│                        API网关层                                │
├─────────────────────────────────────────────────────────────────┤
│  Nginx  │  Spring Cloud Gateway  │  负载均衡  │  限流熔断         │
├─────────────────────────────────────────────────────────────────┤
│                        应用服务层                                │
├─────────────────────────────────────────────────────────────────┤
│  认证服务  │  用户服务  │  动态服务  │  评论服务  │  通知服务      │
├─────────────────────────────────────────────────────────────────┤
│                        数据服务层                                │
├─────────────────────────────────────────────────────────────────┤
│  MySQL  │  Redis  │  MinIO/OSS  │  Elasticsearch  │  RabbitMQ      │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 高并发场景处理策略
- 使用Redis缓存热点数据
- 实现分布式锁防止并发问题
- 使用消息队列异步处理通知、统计等非核心业务
- 数据库读写分离，主库写，从库读
- 对热门动态进行静态化处理

### 5.3 系统水平扩展方案
- 服务无状态化设计，支持水平扩展
- 使用Docker容器化部署，便于扩容
- 使用Kubernetes进行容器编排
- 配置中心统一管理配置
- 服务注册与发现

### 5.4 未来功能扩展预留设计
- 支持私信功能
- 支持话题功能
- 支持直播功能
- 支持数据分析功能
- 支持第三方登录
- 支持多语言国际化

## 6. 代码示例

### 6.1 后端核心代码示例

#### 6.1.1 JWT工具类
```java
public class JwtUtil {
    private static final String SECRET_KEY = "weibo_secret_key"; // 实际应从配置文件读取
    private static final long EXPIRATION_TIME = 24 * 60 * 60 * 1000; // 24小时

    // 生成Token
    public static String generateToken(User user) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("userId", user.getId());
        claims.put("username", user.getUsername());
        return Jwts.builder()
                .setClaims(claims)
                .setSubject(user.getUsername())
                .setIssuedAt(new Date())
                .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION_TIME))
                .signWith(SignatureAlgorithm.HS512, SECRET_KEY)
                .compact();
    }

    // 验证Token
    public static boolean validateToken(String token) {
        try {
            Jwts.parser().setSigningKey(SECRET_KEY).parseClaimsJws(token);
            return true;
        } catch (Exception e) {
            return false;
        }
    }

    // 从Token中获取用户ID
    public static Long getUserIdFromToken(String token) {
        Claims claims = Jwts.parser().setSigningKey(SECRET_KEY).parseClaimsJws(token).getBody();
        return Long.parseLong(claims.get("userId").toString());
    }
}
```

#### 6.1.2 动态发布服务
```java
@Service
public class PostServiceImpl implements PostService {
    @Autowired
    private PostRepository postRepository;
    @Autowired
    private FileService fileService;
    @Autowired
    private NotificationService notificationService;

    @Override
    @Transactional
    public Post createPost(PostDTO postDTO, Long userId) {
        Post post = new Post();
        post.setContent(postDTO.getContent());
        post.setAuthorId(userId);
        post.setParentId(postDTO.getParentId());
        Post savedPost = postRepository.save(post);

        // 处理图片上传
        if (postDTO.getFiles() != null && !postDTO.getFiles().isEmpty()) {
            for (MultipartFile file : postDTO.getFiles()) {
                fileService.uploadFile(file, userId, savedPost.getId());
            }
        }

        // 发送通知（如果是转发）
        if (postDTO.getParentId() != null) {
            Post parentPost = postRepository.findById(postDTO.getParentId()).orElse(null);
            if (parentPost != null && !parentPost.getAuthorId().equals(userId)) {
                notificationService.sendNotification(
                        parentPost.getAuthorId(),
                        userId,
                        NotificationType.REPOST,
                        "转发了你的动态",
                        savedPost.getId()
                );
            }
        }

        return savedPost;
    }
}
```

### 6.2 前端核心代码示例

#### 6.2.1 Axios封装
```typescript
import axios from 'axios';
import { ElMessage } from 'element-plus';
import { useUserStore } from '../stores/user';

const axiosInstance = axios.create({
  baseURL: '/api',
  timeout: 10000
});

// 请求拦截器
axiosInstance.interceptors.request.use(
  (config) => {
    const userStore = useUserStore();
    const token = userStore.token;
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 响应拦截器
axiosInstance.interceptors.response.use(
  (response) => {
    const res = response.data;
    if (res.code !== 200) {
      ElMessage.error(res.message || '请求失败');
      return Promise.reject(new Error(res.message || '请求失败'));
    }
    return res.data;
  },
  (error) => {
    if (error.response?.status === 401) {
      const userStore = useUserStore();
      userStore.logout();
      ElMessage.error('登录已过期，请重新登录');
      window.location.href = '/login';
    } else {
      ElMessage.error(error.message || '网络错误');
    }
    return Promise.reject(error);
  }
);

export default axiosInstance;
```

#### 6.2.2 动态列表组件
```vue
<template>
  <div class="post-list">
    <div v-for="post in posts" :key="post.id" class="post-item">
      <PostCard :post="post" @like="handleLike" @comment="handleComment" @repost="handleRepost" />
    </div>
    <el-pagination
      v-if="total > 0"
      :current-page="currentPage"
      :page-size="pageSize"
      :total="total"
      layout="total, prev, pager, next"
      @current-change="handlePageChange"
      class="pagination"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { usePostStore } from '../stores/post';
import PostCard from '../components/PostCard.vue';

const postStore = usePostStore();
const posts = ref<any[]>([]);
const total = ref(0);
const currentPage = ref(1);
const pageSize = ref(10);

const fetchPosts = async () => {
  const data = await postStore.getPosts(currentPage.value, pageSize.value);
  posts.value = data.records;
  total.value = data.total;
};

const handlePageChange = (page: number) => {
  currentPage.value = page;
  fetchPosts();
};

const handleLike = (postId: number) => {
  postStore.toggleLike(postId);
};

const handleComment = (postId: number) => {
  // 跳转到评论页面或显示评论框
};

const handleRepost = (postId: number) => {
  // 显示转发对话框
};

onMounted(() => {
  fetchPosts();
});
</script>

<style scoped>
.post-list {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.post-item {
  margin-bottom: 20px;
  border-bottom: 1px solid #eee;
  padding-bottom: 20px;
}

.pagination {
  margin-top: 20px;
  text-align: center;
}
</style>
```

## 7. 部署与开源准备

### 7.1 Docker配置
- 提供Dockerfile和docker-compose.yml配置
- 支持一键启动整个应用栈（后端、前端、数据库、Redis）

### 7.2 README文档
- 项目介绍
- 技术栈说明
- 环境要求
- 部署步骤
- 使用说明
- 开发指南

### 7.3 开发文档
- 架构设计文档
- 模块说明文档
- API接口文档（Swagger生成）
- 数据库设计文档

### 7.4 .gitignore配置
- 忽略IDE配置文件
- 忽略依赖包目录
- 忽略日志文件
- 忽略环境配置文件
- 忽略编译生成文件

### 7.5 开源许可证
- 选择MIT License
- 在项目根目录添加LICENSE文件

## 8. 安全防护措施

### 8.1 前端安全
- XSS防护：使用v-html时进行HTML转义
- CSRF防护：使用JWT Token，不使用Cookie
- 输入验证：前端表单验证
- HTTPS：生产环境使用HTTPS

### 8.2 后端安全
- 密码加密：使用BCrypt加密存储
- SQL注入防护：使用JPA/Hibernate，避免原生SQL
- XSS防护：对用户输入进行HTML转义
- CSRF防护：使用JWT Token
- 接口权限控制：基于角色的访问控制
- 敏感数据加密：对敏感数据进行加密存储
- 限流防护：防止恶意请求攻击

## 9. 测试策略

### 9.1 单元测试
- 覆盖核心业务逻辑
- 使用JUnit + Mockito进行测试
- 测试覆盖率≥80%

### 9.2 集成测试
- 测试服务间交互
- 测试数据库操作
- 测试API接口

### 9.3 端到端测试
- 使用Cypress或Playwright进行测试
- 测试核心用户流程

## 10. 性能优化

### 10.1 前端性能优化
- 代码分割：按需加载组件
- 图片懒加载：延迟加载不在视口内的图片
- 缓存静态资源：使用HTTP缓存
- 减少HTTP请求：合并资源
- 使用CDN加速：静态资源使用CDN

### 10.2 后端性能优化
- 数据库索引优化：合理设计索引
- 缓存热点数据：使用Redis缓存
- 异步处理：使用消息队列处理非核心业务
- 连接池优化：配置合适的连接池大小
- 代码优化：减少不必要的计算和IO操作

## 11. 监控与日志

### 11.1 监控
- 使用Prometheus进行指标监控
- 使用Grafana进行可视化展示
- 监控服务健康状态、请求量、响应时间

### 11.2 日志
- 使用SLF4J + Logback进行日志记录
- 分级日志：DEBUG、INFO、WARN、ERROR
- 日志文件滚动分割
- 日志集中管理：使用ELK Stack

## 12. 总结

本技术解决方案设计了一个功能完整、性能优良、安全可靠的微博系统。该系统采用前后端分离架构，后端使用Spring Boot + JPA + MySQL + Redis，前端使用Vue 3 + TypeScript + Pinia + Element Plus。系统支持用户管理、动态发布、社交互动、通知系统等核心功能，并具备良好的扩展性和性能优化策略。

该设计方案考虑了系统的可扩展性、高并发处理、安全防护等方面，为后续的开发和部署提供了详细的指导。